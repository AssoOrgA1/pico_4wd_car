

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>APP Control &mdash; Sunfounder Pico-4wd Car Kit  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Obstacle Avoid" href="example_obstacle_avoid.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Sunfounder Pico-4wd Car Kit
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction_to_pico.html">Introduction to Raspberry Pi Pico</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup_your_pico/setup_your_pico.html">Setup Your Pico</a></li>
<li class="toctree-l1"><a class="reference internal" href="your_first_micropython_program.html">Your First MicroPython Program</a></li>
<li class="toctree-l1"><a class="reference internal" href="test_your_module.html">Test Your Module</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="example.html">Example</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="example_donot_push_me.html">Don’t Push Me</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_line_track.html">Line Track</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_bull_fight.html">Bull Fight</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_obstacle_avoid.html">Obstacle Avoid</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">APP Control</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#how-to-do">How to do?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-it-work">How it work?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#app-control-example">APP Control Example</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Sunfounder Pico-4wd Car Kit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="example.html">Example</a> &raquo;</li>
        
      <li>APP Control</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/example_app_control.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="app-control">
<h1>APP Control<a class="headerlink" href="#app-control" title="Permalink to this headline">¶</a></h1>
<p>这个章节将会指引你使用Sunfounder Controller APP来远程玩耍pico-4wd，这意味着你可以在户外使用手机/平板来控制它四处游荡。</p>
<div class="section" id="how-to-do">
<h2>How to do?<a class="headerlink" href="#how-to-do" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p>Coding</p>
<blockquote>
<div><p>为了方便理解，让我们使用 <strong>tests</strong> 文件夹下的 <code class="docutils literal notranslate"><span class="pre">app_test.py</span></code> （这个代码将会在后面讲解） 来完成第一个 Sunfounder Controller 的实验吧！</p>
<p>运行程序后（此时Pico RDP应也在工作状态），Pico-4wd并没有什么现象。Thonny script 则会出现以下的提示：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; %Run -c $EDITOR_CONTENT
    Connecting
    WebServer started on ws://192.168.4.1:8765
    start
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Install Sunfounder Controller</p>
<blockquote>
<div><p>Search for <strong>Sunfounder Controller</strong> in APP Store (or Google Play). Download it.</p>
<img alt="_images/app_install.png" src="_images/app_install.png" />
</div></blockquote>
</li>
<li><p>连接设备。</p>
<blockquote>
<div><p>在手机（平板）的WLAN上找到 <code class="docutils literal notranslate"><span class="pre">my_4wd_car</span></code> ,连接它，密码是 <code class="docutils literal notranslate"><span class="pre">12345678</span></code> ,这是由Pico RDP释放出来的AP，是不连通万维网的。(如果你需要保持手机(平板)的网络，则可以改用STA模式，这将在后面说道。)</p>
<p>连接成功后，Thonny script 则会显示新连接设备的IP：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; %Run -c $EDITOR_CONTENT
    Connecting
    WebServer started on ws://192.168.4.1:8765
    start
<span class="hll">    Connected from 192.168.4.3
</span></pre></div>
</div>
</div></blockquote>
</li>
<li><p>Open <strong>Sunfounder Controller</strong> , and you will see the HOME PAGE，点击最右上方的icon完成Pico-4wd与手机（平板）的连接.</p>
<blockquote>
<div><img alt="_images/app_home_page.jpg" src="_images/app_home_page.jpg" />
<ul class="simple">
<li><p>中间的大的加号按键可以创建控制器，你可以在Sunfounder Controller中创建多个控制器方案。</p></li>
<li><p>点击左上角的icon可以查看 “ABOUT US”</p></li>
<li><p>右上方红字显示的是Sunfounder Controller当前的连接状况。如果连接到设备（如Pico-4wd）将会变成白色字体。</p></li>
<li><p>编辑按键可以允许你删除多余的控制器。</p></li>
<li><p>你会需要点击最右上方的链接icon来链接到设备。需要注意的是，只有在设备正在运行程序时，Sunfounder Controller才能成功连接（重新烧录代码后将需要重新连接）。</p></li>
</ul>
</div></blockquote>
</li>
<li><p>创建一个控制器，你将能看到一个个的box(一些是矩形，一些是正方形)，我们需要调整它们，以适用于 <code class="docutils literal notranslate"><span class="pre">app_test.py</span></code> 。</p>
<blockquote>
<div><img alt="_images/app_test_controller_1.jpg" src="_images/app_test_controller_1.jpg" />
<p>点击区域D，选择 “雷达” widget。</p>
<img alt="_images/app_test_controller_2.jpg" src="_images/app_test_controller_2.jpg" />
<p>点击区域H，选择 “滑条” widget。</p>
<img alt="_images/app_test_controller_3.jpg" src="_images/app_test_controller_3.jpg" />
<p>点击最右上方的 save icon，控制器会被保存。同时进入工作状态，空的 widget box 隐藏。 （此时原来的 save icon 将会变成 edit icon，点击它可以返回edit状态，以调整widget）。</p>
<img alt="_images/app_test_controller_4.jpg" src="_images/app_test_controller_4.jpg" />
</div></blockquote>
</li>
<li><p>运行。</p>
<blockquote>
<div><p>点击 edit icon 旁边的 run icon，Pico-4wd终于动起来了！（如果未能如期望进行，或 Run icon 旁显示 “Disconnected” ，请重新进行Pico-4wd与手机（平板）的连接，and try again!）</p>
<p>你将能看到 Pico-4wd 的雷达正在扫描，Sunfounder Controller 上的 D box会显示扫描结果；你拨动 H box 的滑条，车尾部的 RGB Board 也会点亮相应的灯。</p>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="how-it-work">
<h2>How it work?<a class="headerlink" href="#how-it-work" title="Permalink to this headline">¶</a></h2>
<p>Pico-4wd和Sunfounder Controller之间的通信基于websocket协议。</p>
<ul class="simple">
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/WebSocket">WebSocket - Wikipedia</a></p></li>
</ul>
<p>其功能已经被写入在了 <code class="docutils literal notranslate"><span class="pre">ws.py</span></code> 中，我们在章节 <a class="reference internal" href="setup_your_pico/import_pico4wd_libraries.html#import-pico-4wd-libraries"><span class="std std-ref">Import Pico-4wd Libraries</span></a> 已经将其载入。</p>
<p>APP Control 玩法的具体的工作流程如下：</p>
<img alt="_images/flowchart_app_control.png" src="_images/flowchart_app_control.png" />
<p>代码如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ws</span> <span class="kn">import</span> <span class="n">WS_Server</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">pico_4wd</span> <span class="k">as</span> <span class="nn">car</span>

<span class="n">NAME</span> <span class="o">=</span> <span class="s1">&#39;my_4wd_car&#39;</span>

<span class="c1">## Client Mode</span>
<span class="c1"># WIFI_MODE = &quot;sta&quot;</span>
<span class="c1"># SSID = &quot;YOUR SSID HERE&quot;</span>
<span class="c1"># PASSWORD = &quot;YOUR PASSWORD HERE&quot;</span>

<span class="c1">## AP Mode</span>
<span class="n">WIFI_MODE</span> <span class="o">=</span> <span class="s2">&quot;ap&quot;</span>
<span class="n">SSID</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="n">PASSWORD</span> <span class="o">=</span> <span class="s2">&quot;12345678&quot;</span>

<span class="n">ws</span> <span class="o">=</span> <span class="n">WS_Server</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">NAME</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">WIFI_MODE</span><span class="p">,</span> <span class="n">ssid</span><span class="o">=</span><span class="n">SSID</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">PASSWORD</span><span class="p">)</span>
<span class="n">ws</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">on_receive</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1"># write control codes here.</span>
    <span class="k">pass</span>

    <span class="c1"># write sensor codes here.</span>
    <span class="k">pass</span>

<span class="n">ws</span><span class="o">.</span><span class="n">on_receive</span> <span class="o">=</span> <span class="n">on_receive</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ws</span><span class="o">.</span><span class="n">loop</span><span class="p">()</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">car</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="s2">&quot;stop&quot;</span><span class="p">)</span>
    <span class="n">car</span><span class="o">.</span><span class="n">set_light_off</span><span class="p">()</span>
</pre></div>
</div>
<p>这个代码已经构成了APP控制的基本框架。在这之中你需要关注的是三个部分：</p>
<ol class="arabic">
<li><p>设置websocket服务器</p>
<blockquote>
<div><p>你可以让连接模式在 Client Mode 和 AP Mode间切换。</p>
<p>默认情况下，Pico-4wd的默认连接方式是 <strong>AP Mode</strong> ：Pico RDP放出热点（Wifi名是代码中的 <code class="docutils literal notranslate"><span class="pre">NAME</span></code>，在这里是 <code class="docutils literal notranslate"><span class="pre">my_4wd_car</span></code> ），手机(平板)连接到这个WLAN中。这个模式可以让你在任何场合遥控Pico-4wd，但是会让你的手机(平板)暂时无法连接网络。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">NAME</span> <span class="o">=</span> <span class="s1">&#39;my_4wd_car&#39;</span>

<span class="hll"><span class="c1">## Client Mode</span>
</span><span class="hll"><span class="c1"># WIFI_MODE = &quot;sta&quot;</span>
</span><span class="hll"><span class="c1"># SSID = &quot;YOUR SSID HERE&quot;</span>
</span><span class="hll"><span class="c1"># PASSWORD = &quot;YOUR PASSWORD HERE&quot;</span>
</span>
<span class="hll"><span class="c1">## AP Mode</span>
</span><span class="hll"><span class="n">WIFI_MODE</span> <span class="o">=</span> <span class="s2">&quot;ap&quot;</span>
</span><span class="hll"><span class="n">SSID</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span class="hll"><span class="n">PASSWORD</span> <span class="o">=</span> <span class="s2">&quot;12345678&quot;</span>
</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">WS_Server</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">NAME</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">WIFI_MODE</span><span class="p">,</span> <span class="n">ssid</span><span class="o">=</span><span class="n">SSID</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">PASSWORD</span><span class="p">)</span>
<span class="n">ws</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>你也可以该用 <strong>Client Mode</strong> : 让Pico RDP连接到你的家庭WLAN，你的手机(平板)也应当连接在同一个WLAN下。这个模式与AP模式相反，不会影响手机（平板）的正常使用，但是会限制你的Pico-4wd不能离开WLAN的辐射范围。</p>
<p>启动该模式的方法是注释掉 <code class="docutils literal notranslate"><span class="pre">##</span> <span class="pre">AP</span> <span class="pre">Mode</span></code> 下的3行，取消注释 <code class="docutils literal notranslate"><span class="pre">##</span> <span class="pre">Client</span> <span class="pre">Mode</span></code> 下的三行，同时将 SSID 和 PASSWORD 改成你的家庭 WIFI。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">NAME</span> <span class="o">=</span> <span class="s1">&#39;my_4wd_car&#39;</span>

<span class="hll"><span class="c1">## Client Mode</span>
</span><span class="hll"><span class="n">WIFI_MODE</span> <span class="o">=</span> <span class="s2">&quot;sta&quot;</span>
</span><span class="hll"><span class="n">SSID</span> <span class="o">=</span> <span class="s2">&quot;Sunfounder&quot;</span>
</span><span class="hll"><span class="n">PASSWORD</span> <span class="o">=</span> <span class="s2">&quot;12345678&quot;</span>
</span>
<span class="hll"><span class="c1">## AP Mode</span>
</span><span class="hll"><span class="c1"># WIFI_MODE = &quot;ap&quot;</span>
</span><span class="hll"><span class="c1"># SSID = &quot;&quot;</span>
</span><span class="hll"><span class="c1"># PASSWORD = &quot;12345678&quot;</span>
</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">WS_Server</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">NAME</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">WIFI_MODE</span><span class="p">,</span> <span class="n">ssid</span><span class="o">=</span><span class="n">SSID</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">PASSWORD</span><span class="p">)</span>
<span class="n">ws</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>完成连接模式设置后，Websocket将会架设并启动服务器。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span> <span class="o">=</span> <span class="n">WS_Server</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">NAME</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">WIFI_MODE</span><span class="p">,</span> <span class="n">ssid</span><span class="o">=</span><span class="n">SSID</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">PASSWORD</span><span class="p">)</span>
<span class="n">ws</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>响应程序</p>
<blockquote>
<div><p>Pico-4wd 与 Sunfounder Controller 的具体运作代码写在 <code class="docutils literal notranslate"><span class="pre">on_receive()</span></code> 函数上。通常，我们需要将 APP控制Pico-4wd的代码写在前方，APP展示Pico-4wd传感器数据的代码写在后方。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_receive</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1"># write control codes here.</span>
    <span class="k">pass</span>

    <span class="c1"># write sensor codes here.</span>
    <span class="k">pass</span>

<span class="n">ws</span><span class="o">.</span><span class="n">on_receive</span> <span class="o">=</span> <span class="n">on_receive</span>
</pre></div>
</div>
<p>在这个示例中，我们写入了 H 区域滑条控制RGB Board灯光点亮数目的控制代码；以及 D 区域展示雷达检测结果的展示代码。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_receive</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1"># write control codes here.</span>
    <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;H_region&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">9</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
        <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">car</span><span class="o">.</span><span class="n">light_excute</span><span class="p">()</span>

    <span class="c1"># write sensor codes here.</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="n">get_radar_distance</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">send_dict</span><span class="p">[</span><span class="s1">&#39;D_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>

<span class="n">ws</span><span class="o">.</span><span class="n">on_receive</span> <span class="o">=</span> <span class="n">on_receive</span>
</pre></div>
</div>
<p>最后， <code class="docutils literal notranslate"><span class="pre">on_receive()</span></code> 会被赋值到 <code class="docutils literal notranslate"><span class="pre">ws.on_receive</span></code> 从而被 <code class="docutils literal notranslate"><span class="pre">ws.loop</span></code> 调用。</p>
</div></blockquote>
</li>
<li><p>传输数据（From APP to Pico-4wd）</p>
<blockquote>
<div><p>让我们来直观的看看，Pico-4wd 会从 APP 中获得什么样的数据。在 <code class="docutils literal notranslate"><span class="pre">on_receive</span></code> 中直接将 <code class="docutils literal notranslate"><span class="pre">data</span></code> 打印出来。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_receive</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1"># write control codes here.</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># write sensor codes here.</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>你将能看到以下的字符串：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;J_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;A_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;L_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;K_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;F_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;M_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;H_region&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s1">&#39;Q_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;G_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;I_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;B_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;D_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;C_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;N_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;E_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;P_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;O_region&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
</pre></div>
</div>
<p>如我们所见，我们看到 H Box 的值为50 ( <cite>‘H_region’: 50</cite> ) ，而其他为 None ， 这是因为我们只在 H Box 添加了用于控制的 widget。（ D 区域的widget不用于控制只用于显示。）</p>
<p>我们可以在 Box 中添加其他的widget，也能用相同的方法查看到这些widget传入Pico-4wd的值。</p>
<p>而需要使用时，只需通过label即可取出对应widget的值。如下方，打印 H Box widget 的值：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_receive</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1"># write control codes here.</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;H_region&#39;</span><span class="p">])</span>

    <span class="c1"># write sensor codes here.</span>
    <span class="k">pass</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; %Run -c $EDITOR_CONTENT
    Connecting
    WebServer started on ws://192.168.4.1:8765
    start
    Connected from 192.168.4.3
    50
    50
    50
</pre></div>
</div>
<p>在Sunfounder Controller中，用于控制的widget包括以下几种：</p>
<img alt="_images/app_widget_control.png" src="_images/app_widget_control.png" />
<p>Pico-4wd 封装有使用模块的函数，我们可以将widget的值写入这些函数中来实现一些事情。如在这里我们使用滑条控制车尾的RGB Board。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_receive</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1"># write control codes here.</span>
    <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;H_region&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">9</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
        <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">car</span><span class="o">.</span><span class="n">light_excute</span><span class="p">()</span>
</pre></div>
</div>
<p>具体的调用Pico-4wd模块的方法请查看 <a class="reference external" href="https://github.com/sunfounder/pico_4wd_car/blob/main/api_reference_pico_4wd.md">API</a>   。</p>
</div></blockquote>
</li>
<li><p>传输数据（From Pico-4wd to APP）</p>
<blockquote>
<div><p>Pico-4wd 封装有使用传感器模块的函数，如读取读取了雷达的值。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_receive</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1"># write sensor codes here.</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="n">get_radar_distance</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; %Run -c $EDITOR_CONTENT
    Connecting
    WebServer started on ws://192.168.4.1:8765
    start
    Connected from 192.168.4.2
    [-10, 49.249]
    [-20, 37.417]
    [-30, 38.947]
    [-40, 36.193]
    [-50, 40.12]
    [-60, 36.431]
</pre></div>
</div>
<p>具体的调用Pico-4wd模块的方法请查看 <a class="reference external" href="https://github.com/sunfounder/pico_4wd_car/blob/main/api_reference_pico_4wd.md">API</a> 。</p>
<p>将这些函数值直接返回到对应的 Box 即可。将其雷达的值输出到D区域的雷达widget。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_receive</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1"># write sensor codes here.</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="n">get_radar_distance</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">send_dict</span><span class="p">[</span><span class="s1">&#39;D_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
</pre></div>
</div>
<p>在Sunfounder Controller中，用于输出的widget包括以下几种：</p>
<img alt="_images/app_widget_display.png" src="_images/app_widget_display.png" />
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="app-control-example">
<h2>APP Control Example<a class="headerlink" href="#app-control-example" title="Permalink to this headline">¶</a></h2>
<p>现在，请打开 <strong>examples</strong> 中de  <code class="docutils literal notranslate"><span class="pre">app_control.py</span></code> ，尝试完整的APP遥控玩法吧！</p>
<img alt="_images/app_control_example.jpg" src="_images/app_control_example.jpg" />
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ws</span> <span class="kn">import</span> <span class="n">WS_Server</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">pico_4wd</span> <span class="k">as</span> <span class="nn">car</span>

<span class="n">NAME</span> <span class="o">=</span> <span class="s1">&#39;my_pico_car&#39;</span>

<span class="c1"># Client Mode</span>
<span class="c1"># WIFI_MODE = &quot;sta&quot;</span>
<span class="c1"># SSID = &quot;YOUR_SSID_HERE&quot;</span>
<span class="c1"># PASSWORD = &quot;YOUR_PASSWORD_HERE&quot;</span>

<span class="c1"># AP Mode</span>
<span class="n">WIFI_MODE</span> <span class="o">=</span> <span class="s2">&quot;ap&quot;</span>
<span class="n">SSID</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="n">PASSWORD</span> <span class="o">=</span> <span class="s2">&quot;12345678&quot;</span>

<span class="n">ws</span> <span class="o">=</span> <span class="n">WS_Server</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">NAME</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">WIFI_MODE</span><span class="p">,</span> <span class="n">ssid</span><span class="o">=</span><span class="n">SSID</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">PASSWORD</span><span class="p">)</span>
<span class="n">ws</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">led_status</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">def</span> <span class="nf">on_receive</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">led_status</span>

    <span class="c1">#Move</span>
    <span class="k">if</span> <span class="s1">&#39;K_region&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;H_region&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="c1"># print(data[&#39;K_region&#39;])</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;K_region&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span><span class="p">:</span>
            <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;K_region&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span>
            <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">car</span><span class="o">.</span><span class="n">write_light_color_at</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">car</span><span class="o">.</span><span class="n">light_excute</span><span class="p">()</span>

        <span class="n">car</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;K_region&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;H_region&#39;</span><span class="p">])</span>

    <span class="c1"># RGB LED</span>
    <span class="k">if</span> <span class="s1">&#39;M_region&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">led_status</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;M_region&#39;</span><span class="p">]</span>

    <span class="c1"># speed measurement</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">send_dict</span><span class="p">[</span><span class="s1">&#39;A_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="n">speed</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">led_status</span><span class="p">:</span>
        <span class="c1"># HUE color system, Red is 0, and Green is 120</span>
        <span class="n">hue</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="n">mapping</span><span class="p">(</span><span class="n">car</span><span class="o">.</span><span class="n">speed</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">rgb</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="n">hue2rgb</span><span class="p">(</span><span class="n">hue</span><span class="p">)</span>
        <span class="n">car</span><span class="o">.</span><span class="n">set_light_bottom_color</span><span class="p">(</span><span class="n">rgb</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">car</span><span class="o">.</span><span class="n">set_light_off</span><span class="p">()</span>

    <span class="c1"># radar</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">send_dict</span><span class="p">[</span><span class="s1">&#39;D_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="n">get_radar_distance</span><span class="p">()</span>

    <span class="c1"># greyscale</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">send_dict</span><span class="p">[</span><span class="s1">&#39;L_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="n">get_grayscale_values</span><span class="p">()</span>


<span class="n">ws</span><span class="o">.</span><span class="n">on_receive</span> <span class="o">=</span> <span class="n">on_receive</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ws</span><span class="o">.</span><span class="n">loop</span><span class="p">()</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">car</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="s2">&quot;stop&quot;</span><span class="p">)</span>
    <span class="n">car</span><span class="o">.</span><span class="n">set_light_off</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="example_obstacle_avoid.html" class="btn btn-neutral float-left" title="Obstacle Avoid" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Sunfounder.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>